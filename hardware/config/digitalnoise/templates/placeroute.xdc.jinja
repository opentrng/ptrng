# This file has been automatically generated, for more information look into the directory 'hardware/config/digitalnoise'.

# Combinational loops for each ring-oscillator
{%- for bank in banks %}
set_property ALLOW_COMBINATORIAL_LOOPS TRUE [get_nets top/ptrng/source/bank[{{ bank['index'] }}].ring/loopback/in0[0]]
{%- endfor %}

# Ring-oscillator maximal output frequency (for proper timing verifications)
{%- for bank in banks %}
create_clock -name ring{{ bank['index'] }}_clk -period {{ 1e9/bank['ring']['fmax'] }} -waveform { 0.0 {{1e9/(2*bank['ring']['fmax'])}} } -add [get_nets top/ptrng/source/bank[{{ bank['index'] }}].ring/net[0]]
{%- endfor %}

# No timing check between system clock and ring clocks
{%- for bank in banks %}
set_false_path -from [get_clocks ring{{ bank['index'] }}_clk] -to [get_clocks sys_clk]
set_false_path -from [get_clocks sys_clk] -to [get_clocks ring{{ bank['index'] }}_clk]
{%- endfor %}

# General pblock for the reserved area
create_pblock digitalnoise
	# add_cells_to_pblock [get_pblocks digitalnoise] [get_cells top/ptrng/source]
	resize_pblock [get_pblocks digitalnoise] -add { {{ reserved }} }
	set_property CONTAIN_ROUTING 1 [get_pblocks digitalnoise]
	set_property EXCLUDE_PLACEMENT 1 [get_pblocks digitalnoise]

{% for entity in ['freq', 'ring'] %}
# Pblock for each {{ entity }}
{%- for bank in banks %}
create_pblock {{ bank[entity]['name'] }}
	add_cells_to_pblock [get_pblocks {{ bank[entity]['name'] }}] [get_cells top/ptrng/source/bank[{{ bank['index'] }}].{{entity}}]
	resize_pblock [get_pblocks {{ bank[entity]['name'] }}] -add { {{ bank[entity]['block']['xilinx'] }} }
	set_property CONTAIN_ROUTING 1 [get_pblocks {{ bank[entity]['name'] }}]
	set_property EXCLUDE_PLACEMENT 1 [get_pblocks {{ bank[entity]['name'] }}]
{%- endfor %}
{% endfor %}

# Ring-oscillator manual placement into slices
#TODO

# Ring-oscillator manual routing
#TODO
